#!/usr/bin/python3
import re
import os
import sys

import helpers

# HOTSOS GLOBALS
VERBOSITY_LEVEL = int(os.environ.get('VERBOSITY_LEVEL', 0))
DATA_ROOT = os.environ.get('DATA_ROOT', '/')

if VERBOSITY_LEVEL < 1:
    sys.exit(0)

vms = []
for line in helpers.get_ps():
    ret = re.compile(".+product=OpenStack Nova.+").match(line)
    if ret:
        ret = re.compile(r".+uuid\s+([a-z0-9\-]+)[\s,]+.+").match(ret[0])
        if ret:
            vms.append(ret[1])

if vms:
    print("  instances ({}):".format(len(vms)))
    for vm in vms:
        print("    - {}".format(vm))
