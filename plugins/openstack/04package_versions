#!/usr/bin/python3
import re
import os
import sys

import helpers

from openstack_common import OST_PROJECTS

# HOTSOS GLOBALS
VERBOSITY_LEVEL = int(os.environ.get('VERBOSITY_LEVEL', 0))
DATA_ROOT = os.environ.get('DATA_ROOT', '/')

if VERBOSITY_LEVEL < 3:
    sys.exit(0)

OST_DEPS = [
    "dnsmasq",
    "keepalived",
    "openvswitch-switch",
    "libvirt-daemon",
    "libvirt-bin",
    "qemu-kvm",
    "ovn",
]

print("  dpkg:")
if helpers.get_dpkg_l():
    for line in helpers.get_dpkg_l():
        for dep in OST_PROJECTS + OST_DEPS:
            ret = re.compile(r"^ii\s+{}\s+([0-9A-Za-z:\-.~]+)\s+.+".
                             format(dep)).match(line)
            if ret:
                print("    - {} {}".format(dep, ret[1]))
