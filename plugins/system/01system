#!/usr/bin/python3
import re
import os

import helpers

# HOTSOS GLOBALS
VERBOSITY_LEVEL = int(os.environ.get('VERBOSITY_LEVEL', 0))
DATA_ROOT = os.environ.get('DATA_ROOT', '/')

print("system:")


for line in helpers.get_lscpu():
    ret = re.compile(r"^CPU\(s\):\s+([0-9]+)\s*.*").match(line)
    if ret:
        print("  num-cpus: {}".format(ret[1]))
        break

for line in helpers.get_uptime():
    ret = re.compile(r".+(load) average:\s+(.+)").match(line)
    if ret:
        print("  load: {}".format(ret[2]))
        break

for line in helpers.get_df():
    ret = re.compile(r"(.+\/$)").match(line)
    if ret:
        print("  rootfs: {}".format(ret[1]))
        break

unattended_upgrades = False
for line in helpers.get_apt_config_dump():
    ret = re.compile(r"^APT::Periodic::Unattended-Upgrade\s+"
                     "\"([0-9]+)\";").match(line)
    if ret:
        if int(ret[1]) == 0:
            unattended_upgrades = False
        else:
            unattended_upgrades = True

if unattended_upgrades:
    print("  unattended-upgrades: ENABLED")
else:
    print("  unattended-upgrades: disabled")
